<ion-header>
  <ion-toolbar>
    <ion-title>Lab Borrow Dashboard</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()">Logout</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <p>
    สวัสดี, <strong>{{ me?.displayName }}</strong>
    <ion-badge style="margin-left: 8px">{{ me?.role }}</ion-badge>
  </p>
  <p *ngIf="!isAdmin" style="opacity: 0.75">
    หมายเหตุ: ผู้ใช้ทั่วไป “ลบรายการไม่ได้” และ
    “คืนได้เฉพาะรายการที่ยืมด้วยชื่อของตน”
  </p>

  <h3>{{ editingId ? "แก้ไขข้อมูลอุปกรณ์" : "เพิ่มอุปกรณ์" }}</h3>

  <form [formGroup]="form" (ngSubmit)="editingId ? saveEdit() : add()">
    <ion-item>
      <ion-label position="stacked">ชื่ออุปกรณ์</ion-label>
      <ion-input
        formControlName="itemName"
        placeholder="เช่น Laptop Dell"
      ></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">หมวดหมู่</ion-label>
      <ion-select formControlName="category">
        <ion-select-option value="Computer">Computer</ion-select-option>
        <ion-select-option value="Network">Network</ion-select-option>
        <ion-select-option value="Electronics">Electronics</ion-select-option>
        <ion-select-option value="Other">Other</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">จำนวน</ion-label>
      <ion-input type="number" formControlName="qty"></ion-input>
    </ion-item>

    <ion-button expand="block" type="submit">
      {{ editingId ? "บันทึกการแก้ไข" : "เพิ่มอุปกรณ์" }}
    </ion-button>

    <ion-button
      *ngIf="editingId"
      expand="block"
      fill="outline"
      (click)="cancelEdit()"
    >
      ยกเลิกการแก้ไข
    </ion-button>
  </form>

  <h3 style="margin-top: 18px">Data Table (Array) - รายการอุปกรณ์</h3>

  <ion-grid>
    <ion-row
      style="font-weight: 700; border-bottom: 1px solid #ddd; padding: 8px 0"
    >
      <ion-col size="1">ID</ion-col>
      <ion-col size="4">อุปกรณ์</ion-col>
      <ion-col size="2">หมวด</ion-col>
      <ion-col size="1">Qty</ion-col>
      <ion-col size="2">Status</ion-col>
      <ion-col size="2">ผู้ยืม</ion-col>
    </ion-row>

    <ion-row
      *ngFor="let r of rows"
      style="border-bottom: 1px solid #f0f0f0; padding: 8px 0"
    >
      <ion-col size="1">{{ r._id }}</ion-col>
      <ion-col size="4">{{ r.itemName }}</ion-col>
      <ion-col size="2">{{ r.category }}</ion-col>
      <ion-col size="1">{{ r.qty }}</ion-col>
      <ion-col size="2">
        <ion-badge>{{ r.status }}</ion-badge>
      </ion-col>
      <ion-col size="2">{{ r.borrowerName || "-" }}</ion-col>

      <ion-col
        size="12"
        style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 8px"
      >
        <ion-button size="small" fill="outline" (click)="startEdit(r)"
          >Edit</ion-button
        >
        <ion-button size="small" color="danger" (click)="remove(r._id)"
          >Delete</ion-button
        >

        <ion-button
          size="small"
          fill="outline"
          (click)="borrow(r)"
          [disabled]="r.status === 'borrowed'"
        >
          Borrow
        </ion-button>
        <ion-button
          size="small"
          fill="outline"
          (click)="returnEquip(r)"
          [disabled]="r.status === 'available'"
        >
          Return
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-toast
    [isOpen]="toastOpen"
    (didDismiss)="toastOpen = false"
    [message]="toastMsg"
    duration="2000"
  >
  </ion-toast>
</ion-content>
